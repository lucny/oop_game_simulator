@startuml Class_Diagram_ABC_Architecture
!theme plain
skinparam classAttributeIconSize 0
skinparam classBackgroundColor #E1F5FE
skinparam classBorderColor #01579B

title OOP Game Simulator - Abstraktní Architektura (tournament_abc.py)

package game {
  enum Gender {
    male
    female
  }

  class Dice {
    +{static} roll(max_value=6) : int
  }

  class Person {
    #nickname : str
    #{static} _gender : Gender
    #{static} _birth : datetime
    +gender : Gender
    +get_seconds_from_birth() : int
  }

  class Player {
    +state : str
    +count_of_games : int
    #{static} _wins : int
    +score : Dict
    +wins : int
    +win_rate() : float
    +overall_score() : Tuple
  }

  class Match {
    #{static} _hplayer : Player
    #{static} _gplayer : Player
    +winning_score : int
    +max_dice_value : int
    #{static} _datetime : datetime
    +hp_points : int
    +gp_points : int
    #{static} _history : List
    +h_player : Player
    +g_player : Player
    +play() : None
    +score() : Tuple
    +get_history() : List
    +save_match_results(filename) : None
  }

  Gender <-- Person
  Player --|> Person
  Match o-- Player
  Match --> Dice
}

package tournament_abc {
  abstract class BaseTournament {
    #{protected} players : List[Player]
    +location : str
    +winning_score : int
    +max_dice_value : int
    #{protected} _datetime : datetime
    #{protected} matches : List[Match]
    +winner : Optional[Player]
    #{protected} _detailed_results : List[Dict]
    --
    +{abstract} play() : None
    +{abstract} _print_tournament_header() : None
    +{abstract} _get_tournament_type_name() : str
    +{abstract} _get_total_rounds() : int
    --
    +get_standings() : List[Tuple]
    +print_standings() : None
    +save_tournament_results(filename) : None
    #{protected} _print_current_standings() : None
  }

  class RoundRobinTournament {
    +play() : None
    +_print_tournament_header() : None
    +_get_tournament_type_name() : str
    +_generate_round_robin_schedule() : List
    +_determine_winner() : None
    +_get_total_rounds() : int
  }

  class EliminationTournament {
    +play() : None
    +_print_tournament_header() : None
    +_get_tournament_type_name() : str
    +_get_elimination_round_name(num_players) : str
    +_get_total_rounds() : int
  }

  BaseTournament <|-- RoundRobinTournament
  BaseTournament <|-- EliminationTournament
}

BaseTournament o-- "many" Match
BaseTournament o-- "many" Player

note right of BaseTournament
  Abstraktní bázová třída (ABC)
  definuje kontrakt pro všechny
  typy turnajů
end note

note right of RoundRobinTournament
  Konkrétní implementace
  pro turnaj "Každý s každým"
  s generováním kol
end note

note right of EliminationTournament
  Konkrétní implementace
  pro vyřazovací systém
  (pavouk/bracket)
end note

@enduml

' ============================================================================

@startuml Inheritance_Hierarchy
!theme plain
skinparam classBackgroundColor #FFF9C4
skinparam classBorderColor #F57F17

title Hierarchie dědičnosti - Tournament ABC

object BaseTournament {
  __abstractní třída__
  Definuje: players, location, winner
  Abstraktní: play(), _print_tournament_header()
  Konkrétní: get_standings(), print_standings()
}

object RoundRobinTournament {
  __Konkrétní třída 1__
  Implementuje: play() pro round-robin
  Navíc: _generate_round_robin_schedule()
  Navíc: _determine_winner()
}

object EliminationTournament {
  __Konkrétní třída 2__
  Implementuje: play() pro eliminaci
  Navíc: _get_elimination_round_name()
  Navíc: while smyčka místo for
}

BaseTournament <|-- RoundRobinTournament : implements
BaseTournament <|-- EliminationTournament : implements

note left of BaseTournament
  ABC - Abstract Base Class
  Vynucuje implementaci abstraktních metod
end note

note left of RoundRobinTournament
  Turnaj "Každý s každým"
  N-1 kol, každý s každým
end note

note left of EliminationTournament
  Turnaj "Pavouk"
  While smyčka, vítěz postupuje
end note

@enduml

' ============================================================================

@startuml Polymorphism_Example
!theme plain
skinparam sequenceLifeLineBorderColor #003D82
skinparam sequenceMessageAlignment center

title Polymorfismus v tournament_abc.py

participant "Hlavní program" as main
participant "RoundRobinTournament" as rr
participant "EliminationTournament" as elim

main -> main : tournaments = [
main -> main : RoundRobinTournament(...),
main -> main : EliminationTournament(...)
main -> main : ]

loop pro každý tournament v tournaments:
  main -> rr : tournament.play()
  activate rr
  rr -> rr : _print_tournament_header()
  rr -> rr : schedule = _generate_round_robin_schedule()
  rr -> rr : for round in schedule: hrají se zápasy
  deactivate rr

  main -> elim : tournament.play()
  activate elim
  elim -> elim : _print_tournament_header()
  elim -> elim : while remaining_players > 1:
  elim -> elim : hrají se zápasy, poražení vypadávají
  deactivate elim
end

main -> main : Všechny turnaje odehrány!

note right of main
  Polymorfismus: Stejné volání play()
  Různé implementace v každé podtřídě
end note

@enduml

' ============================================================================

@startuml Template_Method_Pattern
!theme plain
skinparam classBackgroundColor #E8F5E9
skinparam classBorderColor #1B5E20

title Template Method Pattern v BaseTournament

class BaseTournament {
  save_tournament_results(filename)
  {
    Definuje struktura JSON:
    1. tournament_info
    2. players
    3. winner
    4. matches
    5. final_standings
    6. statistics
    
    Volá abstraktní metody:
    - _get_tournament_type_name()
    - _get_total_rounds()
  }
}

class RoundRobinTournament {
  _get_tournament_type_name()
  {
    return "round_robin"
  }
}

class EliminationTournament {
  _get_tournament_type_name()
  {
    return "elimination"
  }
}

BaseTournament <|-- RoundRobinTournament
BaseTournament <|-- EliminationTournament

note bottom of BaseTournament
  Template Method Pattern:
  
  Bázová třída definuje STRUKTURU (šablonu)
  metody save_tournament_results()
  
  Podtřídy vyplňují KONKRÉTNÍ HODNOTY
  voláním abstraktních metod
  
  Výsledek: Stejná logika, různá data
end note

@enduml

' ============================================================================

@startuml Abstract_Method_Enforcement
!theme plain
skinparam classBackgroundColor #FFE0B2
skinparam classBorderColor #E65100

title Vynucení abstraktních metod

class BaseTournament {
  {abstract} play()
  {abstract} _print_tournament_header()
  {abstract} _get_tournament_type_name()
  {abstract} _get_total_rounds()
}

class IncompleteImplementation {
  ..incomplete..
  play()
  ' Chybí: _print_tournament_header()
}

class RoundRobinTournament {
  play()
  _print_tournament_header()
  _get_tournament_type_name()
  _get_total_rounds()
}

class EliminationTournament {
  play()
  _print_tournament_header()
  _get_tournament_type_name()
  _get_total_rounds()
}

BaseTournament <|-- IncompleteImplementation : CHYBA!
BaseTournament <|-- RoundRobinTournament : OK
BaseTournament <|-- EliminationTournament : OK

note right of IncompleteImplementation
  TypeError: Can't instantiate
  abstract class IncompleteImplementation
  with abstract methods
  _print_tournament_header, ...
end note

note right of RoundRobinTournament
  ✓ Všechny abstraktní metody
  jsou implementovány
  ✓ Lze instancializovat
end note

note right of EliminationTournament
  ✓ Všechny abstraktní metody
  jsou implementovány
  ✓ Lze instancializovat
end note

@enduml

' ============================================================================

@startuml Sequence_RoundRobin_Play
!theme plain
title Sekvence - RoundRobinTournament.play()

participant Client
participant RoundRobinTournament as RR
participant Schedule as "Schedule\nGenerator"
participant Match
participant Player

Client -> RR : play()
activate RR

RR -> RR : _print_tournament_header()
note right : Vytiskne: "TURNAJ: Každý s každým"

RR -> Schedule : _generate_round_robin_schedule()
activate Schedule
Schedule -> Schedule : n = len(players)
Schedule -> Schedule : Pokud lichý: přidej BYE
Schedule -> Schedule : Pro každé kolo (n-1 kol):
Schedule -> Schedule : Spáruj hráče a rotuj
Schedule --> RR : List[List[Tuple[Player, Player]]]
deactivate Schedule

RR -> RR : for round_num, round_matches in schedule:
RR -> RR : for player1, player2 in round_matches:

RR -> Match : Match(player1, player2)
Match -> Match : play()
note right : Zápas probíhá

Match --> RR : Vítěz, skóre, historie

RR -> RR : _detailed_results.append({...})
note right : Uloží detaily zápasu

RR -> RR : Mezivýsledky po každém kole
RR -> RR : _print_current_standings()

RR -> RR : _determine_winner()
note right : Určí vítěze podle výher + skóre

RR --> Client : Turnaj odehrán
deactivate RR

@enduml

' ============================================================================

@startuml Sequence_Elimination_Play
!theme plain
title Sekvence - EliminationTournament.play()

participant Client
participant EliminationTournament as ELIM
participant Match
participant Player

Client -> ELIM : play()
activate ELIM

ELIM -> ELIM : _print_tournament_header()
note right : Vytiskne: "TURNAJ: Eliminační systém"

ELIM -> ELIM : remaining_players = players.copy()
ELIM -> ELIM : round_num = 1

ELIM -> ELIM : while len(remaining_players) > 1:
activate ELIM

ELIM -> ELIM : round_name = _get_elimination_round_name()
note right : "FINÁLE", "SEMIFINÁLE", atd.

alt Lichý počet hráčů
  ELIM -> ELIM : bye_player = remaining_players[0]
  ELIM -> ELIM : Vytiskne: "Postupuje automaticky"
  ELIM -> ELIM : next_round_players = [bye_player]
else Sudý počet
  ELIM -> ELIM : next_round_players = []
end

ELIM -> ELIM : for i in range(0, len(remaining), 2):
ELIM -> ELIM : player1, player2 = remaining[i:i+2]

ELIM -> Match : Match(player1, player2)
Match -> Match : play()
Match --> ELIM : Vítěz, skóre

ELIM -> ELIM : next_round_players.append(winner)
ELIM -> ELIM : _detailed_results.append({...})

ELIM -> ELIM : remaining_players = next_round_players
ELIM -> ELIM : round_num += 1

deactivate ELIM

ELIM -> ELIM : self.winner = remaining_players[0]
note right : Poslední zbylý hráč

ELIM --> Client : Turnaj odehrán
deactivate ELIM

@enduml

' ============================================================================

@startuml Comparison_Architecture
!theme plain
skinparam classBackgroundColor #F3E5F5
skinparam classBorderColor #4A148C

title Srovnění architektur - tournament.py vs tournament_abc.py

rectangle tournament_py {
  component "Tournament" as T1 {
    interface "enum TournamentType"
    interface "if tournament_type == ROUND_ROBIN"
    interface "if tournament_type == ELIMINATION"
  }
}

rectangle tournament_abc_py {
  component "BaseTournament (ABC)" as T2 {
    interface "Abstract play()"
    interface "Abstract _print_tournament_header()"
  }
  
  component "RoundRobinTournament" as RR2 {
    interface "play() - round-robin"
  }
  
  component "EliminationTournament" as E2 {
    interface "play() - elimination"
  }
  
  T2 -- RR2 : dědičnost
  T2 -- E2 : dědičnost
}

note right of T1
  tournament.py:
  - 1 třída
  - if-elif podmínky
  - Procedurální přístup
  - Těžko se rozšiřuje
end note

note right of T2
  tournament_abc.py:
  - 3 třídy
  - Bez if-elif (polymorfismus)
  - OOP přístup
  - Snadné rozšíření
end note

@enduml

' ============================================================================

@startuml Usage_Example
!theme plain
title Příklad použití - tournament_abc.py

box "Uživatelský kód"
  participant "main.py"
end box

box "tournament_abc"
  participant "RoundRobinTournament"
  participant "EliminationTournament"
  participant "BaseTournament"
end box

main.py -> RoundRobinTournament : t1 = RoundRobinTournament(\n  players, "Praha")

main.py -> EliminationTournament : t2 = EliminationTournament(\n  players, "Brno")

main.py -> RoundRobinTournament : t1.play()
activate RoundRobinTournament
RoundRobinTournament -> RoundRobinTournament : Implementace\nround-robin
deactivate RoundRobinTournament

main.py -> EliminationTournament : t2.play()
activate EliminationTournament
EliminationTournament -> EliminationTournament : Implementace\neliminace
deactivate EliminationTournament

main.py -> BaseTournament : t1.print_standings()
main.py -> BaseTournament : t2.save_tournament_results()

note over main.py
  Polymorfismus:
  Stejné rozhraní (play, print_standings)
  Různé implementace v každé podtřídě
end note

@enduml
